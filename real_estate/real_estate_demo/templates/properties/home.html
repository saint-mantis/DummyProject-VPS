{% extends 'base.html' %}
{% load static %}

{% block title %}TRUSTER - Find Your Dream Home{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center min-vh-75">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="hero-title fade-in">
                        Find The Best Home<br>
                        for You & Your Family
                    </h1>
                    <p class="hero-subtitle slide-up">
                        Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the
                    </p>
                    
                    <!-- Search Form Inline -->
                    <div class="search-form-inline mt-4 slide-up">
                        <form method="GET" action="{% url 'property_search' %}" class="d-flex flex-wrap gap-3 align-items-end">
                            <div class="flex-fill" style="min-width: 200px;">
                                <label class="form-label text-white fw-bold">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>LOCATION
                                </label>
                                <select class="form-select" name="location" id="location">
                                    <option value="">Mirpur Dohs, Dhaka</option>
                                    {% for location in locations %}
                                        <option value="{{ location.slug }}">{{ location.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="flex-fill" style="min-width: 200px;">
                                <label class="form-label text-white fw-bold">
                                    <i class="fas fa-dollar-sign text-primary me-2"></i>PRICE
                                </label>
                                <select class="form-select" name="price_range">
                                    <option value="">150.00 - 200.00</option>
                                    <option value="0-100000">Under $100,000</option>
                                    <option value="100000-300000">$100,000 - $300,000</option>
                                    <option value="300000-500000">$300,000 - $500,000</option>
                                    <option value="500000-1000000">$500,000 - $1,000,000</option>
                                    <option value="1000000+">Over $1,000,000</option>
                                </select>
                            </div>
                            <div class="flex-shrink-0">
                                <button type="submit" class="btn btn-primary btn-lg px-4">
                                    Search
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-image-container fade-in">
                    <img src="{% static 'images/hero-property.jpg' %}" alt="Modern Home" class="hero-image img-fluid">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Most Searched Location Section -->
<section class="py-5 bg-light-gray">
    <div class="container">
        <div class="row">
            <div class="col-lg-6 mb-4">
                <h2 class="mb-3">Most Searched Location</h2>
                <p class="text-muted mb-4">
                    Very strategic location. Suitable for families with a modern home look
                </p>
                <a href="{% url 'property_list' %}" class="btn btn-outline-primary">
                    See all <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
        
        <div class="row">
            {% for property in featured_properties %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="property-card">
                    {% if property.get_primary_image %}
                        <div class="property-card-image" style="background-image: url('{{ property.get_primary_image.url }}');">
                            <div class="property-card-badge">{{ property.listing_type|capfirst }}</div>
                        </div>
                    {% else %}
                        {% cycle 'images/properties/4b64c203-cc2e-4621-8f78-9e8e0965a66e.jpg' 'images/properties/05652eb8-ff6a-4a9f-9b07-128007270bda.jpg' 'images/properties/Gemini_Generated_Image_mjqm8ymjqm8ymjqm.png' as property_image silent %}
                        <div class="property-card-image" style="background-image: url('{% static property_image %}');">
                            <div class="property-card-badge">{{ property.listing_type|capfirst }}</div>
                        </div>
                    {% endif %}
                    <div class="property-card-body">
                        <h5 class="property-card-title">{{ property.title }}</h5>
                        <p class="property-card-location">
                            <i class="fas fa-map-marker-alt me-2"></i>{{ property.location.name }}
                        </p>
                        <div class="property-card-price">${{ property.price|floatformat:0 }}</div>
                        <div class="property-card-features">
                            <div class="property-feature">
                                <i class="fas fa-bed"></i>{{ property.bedrooms }} bed
                            </div>
                            <div class="property-feature">
                                <i class="fas fa-bath"></i>{{ property.bathrooms }} bath
                            </div>
                            <div class="property-feature">
                                <i class="fas fa-ruler-combined"></i>{{ property.area_sqft }} sqft
                            </div>
                        </div>
                        <a href="{{ property.get_absolute_url }}" class="btn btn-outline-primary w-100">View Details</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="fas fa-home fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No featured properties available</h4>
                    <p class="text-muted">Check back later for featured listings</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section class="stats-section bg-white">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-number" data-target="470">470+</div>
                    <div class="stat-label">Active Listing</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-number" data-target="579">579+</div>
                    <div class="stat-label">Sold Property</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-number" data-target="98">98%</div>
                    <div class="stat-label">Positive Reviews</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-number" data-target="15">15+</div>
                    <div class="stat-label">Years Experience</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- About Section -->
<section class="py-5 bg-light-gray" id="about">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4">
                <h2 class="mb-4">About TRUSTER</h2>
                <p class="lead text-muted mb-4">
                    Your trusted partner in finding the perfect home. We provide comprehensive real estate services with a modern approach and years of experience.
                </p>
                <p class="mb-4">
                    Since our establishment, TRUSTER has been committed to helping families and individuals find their dream homes. Our team of experienced real estate professionals understands the local market and is dedicated to providing exceptional service throughout your property journey.
                </p>
                
                <div class="row mb-5">
                    <div class="col-md-6 mb-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon-circle bg-primary me-4">
                                <i class="fas fa-award text-white"></i>
                            </div>
                            <div>
                                <h4 class="mb-1 fw-bold">15+ Years</h4>
                                <p class="text-muted mb-0">Experience</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="d-flex align-items-center">
                            <div class="stat-icon-circle bg-success me-4">
                                <i class="fas fa-users text-white"></i>
                            </div>
                            <div>
                                <h4 class="mb-1 fw-bold">1000+</h4>
                                <p class="text-muted mb-0">Happy Clients</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <a href="{% url 'property_list' %}" class="btn btn-primary me-3">
                    Explore Properties
                </a>
                <a href="#contact" class="btn btn-outline-primary">
                    Contact Us
                </a>
            </div>
            
            <div class="col-lg-6">
                <div class="about-images">
                    <div class="image-stack">
                        <img src="{% static 'images/properties/4b64c203-cc2e-4621-8f78-9e8e0965a66e.jpg' %}" 
                             alt="Alpha House" class="img-fluid rounded shadow-lg primary-image">
                        <img src="{% static 'images/properties/05652eb8-ff6a-4a9f-9b07-128007270bda.jpg' %}" 
                             alt="Modern Property" class="img-fluid rounded shadow-lg secondary-image">
                    </div>
                </div>
            </div>
        </div>
        
    </div>
</section>

<!-- Testimonials Section -->
<section class="py-5 bg-white" id="testimonials">
    <div class="container">
        <div class="text-center mb-5">
            <h2>Testimonials from lovely previous buyers</h2>
            <p class="text-muted">Let's read what has been the experience of our customers with property</p>
        </div>
        
        <div class="row">
            {% for testimonial in testimonials %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="testimonial-card">
                    {% if testimonial.image %}
                        <img src="{{ testimonial.image.url }}" alt="{{ testimonial.name }}" class="testimonial-avatar">
                    {% else %}
                        <div class="testimonial-avatar bg-primary d-flex align-items-center justify-content-center text-white fs-3">
                            {{ testimonial.name|first }}
                        </div>
                    {% endif %}
                    
                    <div class="testimonial-rating">
                        {% for i in "12345"|make_list %}
                            {% if forloop.counter <= testimonial.rating %}
                                <i class="fas fa-star"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    <p class="testimonial-content">"{{ testimonial.content }}"</p>
                    
                    <div class="testimonial-author">{{ testimonial.name }}</div>
                    <div class="testimonial-role">{{ testimonial.role|default:"Happy Customer" }}</div>
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="text-center">
                    <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No testimonials yet</h4>
                    <p class="text-muted">Be the first to share your experience with us</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Services Section -->
<section class="py-5 bg-light-gray" id="services">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="mb-3">Our Services</h2>
            <p class="text-muted lead">Comprehensive real estate solutions tailored to your needs</p>
        </div>
        
        <div class="row g-4">
            <div class="col-lg-4 col-md-6">
                <div class="service-card text-center h-100">
                    <div class="service-icon-wrapper">
                        <div class="service-icon bg-primary">
                            <i class="fas fa-home"></i>
                        </div>
                    </div>
                    <h4 class="mb-3">Property Sales</h4>
                    <p class="text-muted">Expert guidance in buying and selling residential and commercial properties with market expertise.</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="service-card text-center h-100">
                    <div class="service-icon-wrapper">
                        <div class="service-icon bg-success">
                            <i class="fas fa-key"></i>
                        </div>
                    </div>
                    <h4 class="mb-3">Property Rentals</h4>
                    <p class="text-muted">Comprehensive rental services for landlords and tenants with full property management.</p>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="service-card text-center h-100">
                    <div class="service-icon-wrapper">
                        <div class="service-icon bg-warning">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <h4 class="mb-3">Market Analysis</h4>
                    <p class="text-muted">In-depth market research and property valuation services for informed decisions.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Us Section -->
<section class="py-5 bg-white" id="contact">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="mb-3">Contact Us</h2>
            <p class="text-muted lead">Get in touch with us for any inquiries about properties or our services</p>
        </div>
        
        <div class="row mb-5">
            <!-- Contact Form -->
            <div class="col-lg-8 mb-4">
                <div class="contact-form-container">
                    <h4 class="mb-4">Send us a Message</h4>
                    <form id="contactForm" method="POST">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" name="email" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" name="phone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Inquiry Type</label>
                                <select class="form-select" name="inquiry_type">
                                    <option value="general">General Inquiry</option>
                                    <option value="buying">Buying Inquiry</option>
                                    <option value="selling">Selling Inquiry</option>
                                    <option value="renting">Renting Inquiry</option>
                                    <option value="investment">Investment Inquiry</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Subject *</label>
                            <input type="text" class="form-control" name="subject" required>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Message *</label>
                            <textarea class="form-control" name="message" rows="5" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>Send Message
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Contact Info -->
            <div class="col-lg-4 mb-4">
                <div class="contact-info-container">
                    <h4 class="mb-4">Get in Touch</h4>
                    
                    <div class="contact-info-item mb-4">
                        <div class="d-flex align-items-start">
                            <div class="contact-icon me-3">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Office Address</h6>
                                <p class="text-muted mb-0">
                                    Business Bay, Dubai, United Arab Emirates
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contact-info-item mb-4">
                        <div class="d-flex align-items-start">
                            <div class="contact-icon me-3">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Phone</h6>
                                <p class="text-muted mb-0">+971 4 123 4567</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contact-info-item mb-4">
                        <div class="d-flex align-items-start">
                            <div class="contact-icon me-3">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Email</h6>
                                <p class="text-muted mb-0">info@truster.com</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contact-info-item">
                        <div class="d-flex align-items-start">
                            <div class="contact-icon me-3">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <h6 class="mb-1">Working Hours</h6>
                                <p class="text-muted mb-0">
                                    Mon - Fri: 9:00 AM - 6:00 PM<br>
                                    Sat: 10:00 AM - 4:00 PM
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Google Map - Full Width -->
        <div class="row">
            <div class="col-12">
                <div class="contact-map-section">
                    <h4 class="text-center mb-4">Our Location</h4>
                    <div class="map-container-full">
                        <iframe 
                            src="https://maps.google.com/maps?q=Business+Bay,+Dubai,+UAE&t=&z=15&ie=UTF8&iwloc=&output=embed"
                            width="100%" 
                            height="100%" 
                            style="border:0; border-radius: 12px;" 
                            allowfullscreen="" 
                            loading="lazy" 
                            referrerpolicy="no-referrer-when-downgrade"
                            title="TRUSTER Office Location - Business Bay, Dubai">
                        </iframe>
                    </div>
                    <div class="map-info mt-3 text-center">
                        <p class="text-muted mb-2">
                            <i class="fas fa-map-marker-alt text-primary me-2"></i>
                            <strong>TRUSTER Real Estate Office</strong>
                        </p>
                        <p class="text-muted mb-0">Business Bay, Dubai, United Arab Emirates</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
// Initialize contact form functionality
function initializeContactForm() {
    const contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(contactForm);
            const submitBtn = contactForm.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
            submitBtn.disabled = true;
            
            fetch('{% url "contact_form" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Show success message
                    showAlert('success', data.message);
                    contactForm.reset();
                } else {
                    // Show error message
                    showAlert('error', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('error', 'An error occurred. Please try again.');
            })
            .finally(() => {
                // Reset button state
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    }
}

// Show alert messages
function showAlert(type, message) {
    // Remove any existing alerts
    const existingAlert = document.querySelector('.contact-alert');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    // Create new alert
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'danger'} contact-alert mt-3`;
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
        ${message}
    `;
    
    // Insert alert after the form
    const contactForm = document.getElementById('contactForm');
    contactForm.parentNode.insertBefore(alertDiv, contactForm.nextSibling);
    
    // Auto-remove alert after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

// Initialize homepage specific functionality
document.addEventListener('DOMContentLoaded', function() {
    // Initialize contact form
    initializeContactForm();
    
    // Add animation to elements when they come into view
    const animatedElements = document.querySelectorAll('.fade-in, .slide-up');
    animatedElements.forEach((el, index) => {
        setTimeout(() => {
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}